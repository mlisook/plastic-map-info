<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
    <title>Test browser-capabilities</title>
    <meta name="description" content="Test browser-capabilities">
    <style>
    </style>
    <script src="node_modules/ua-parser-js/src/ua-parser.js"></script>
    <script src="bcap.js"></script>

</head>

<body>
    <div id="contentArea">

    </div>
    <script>
        function getBuildConfiguration(configFileName) {
            var fName = configFileName || 'polymer.json';
            var cfgXmlhttp = new XMLHttpRequest();
            cfgXmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var cfg = JSON.parse(this.responseText);
                    var bc = getBrowserCap(cfg);
                    // showBrowserCap(bc);
                    var loc = window.location.href.replace('index.html','');
                    loc =loc  + bc.basePath;
                    window.location.assign(loc);
                }
            };
            cfgXmlhttp.open("GET", fName, true);
            cfgXmlhttp.send();

        }

        function getBrowserCap(cfg) {
            var userAgent = navigator.userAgent;
            var uap = new UAParser(userAgent);
            var cc = BrowserCap.browserCapabilities(userAgent);
            var bld = BrowserCap.chooseBuild(cfg.builds, cc);
            return {
                clientCapabilities: cc,
                uap: uap,
                userAgent: userAgent,
                browserName: uap.getBrowser().name,
                browserVersion: uap.getBrowser().version,
                configuration: cfg,
                build: bld.build,
                basePath: bld.basePath
            };
        }

        function showBrowserCap(bc) {
            var contentArea = document.getElementById('contentArea');
            contentArea.innerHTML +=
                '<h1>Browser Capabilities Test</h1><h2>User Agent</h2><span>' + bc.userAgent + '</span>' +
                '<h2>Browser</h2><span>' + bc.browserName + ', </span><span>' + bc.browserVersion +
                '</span>' +
                '<h2>Browser Cap</h2><span>' + JSON.stringify(bc.clientCapabilities) + '</span>' +
                '<h2>Selected Build</h2><a href="./builds/' + bc.build + '/">' + bc.build + '</a>';
            console.log(bc);
                
        }

        getBuildConfiguration();
    </script>
</body>

</html>